{% extends 'headerfooterlinks.html' %}

{% load static %}

{% block title %}Assignments & Submissions | AbrayTech{% endblock %}

{% block page_title %}Assignments & Submissions{% endblock %}

{% block breadcrumbs %}
<li class="breadcrumb-item active" aria-current="page">Assignments & Submissions</li>
{% endblock %}

{% block content %}
<!-- Breadcrumbs Section -->
<section class="breadcrumbs-section py-5 bg-light" style="margin-top: 80px;">
    <div class="container">
        <nav style="--bs-breadcrumb-divider: 'â€º';" aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'user_dashboard' %}">Home</a></li>
                <li class="breadcrumb-item" aria-current="page">{{user.first_name}} {{user.last_name}} Dashboard</li>
                {% comment %} <li class="breadcrumb-item active" aria-current="page">My Profile</li> {% endcomment %}
            </ol>
        </nav>
    </div>
</section><!-- End Breadcrumbs Section -->

<section class="container">
    <div class="assignments-dashboard">
        <!-- Active Assignments Section -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-hourglass-split me-2"></i>Active Assignments</h5>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Filter
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="filterDropdown">
                        <li><a class="dropdown-item" href="#">All Courses</a></li>
                        <li><a class="dropdown-item" href="#">Due This Week</a></li>
                        <li><a class="dropdown-item" href="#">Recently Added</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Assignment</th>
                                <th>Course</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for assignment in active_assignments %}
                            <tr>
                                <td>{{ assignment.title }}</td>
                                <td>{{ assignment.course.name }}</td>
                                <td>
                                    {{ assignment.due_date }}
                                    {% if assignment.is_overdue %}
                                    <span class="badge bg-danger">Overdue</span>
                                    {% elif assignment.due_soon %}
                                    <span class="badge bg-warning">Due Soon</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if assignment.submission %}
                                    <span class="badge bg-success">Submitted</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Not Submitted</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'assignment_detail' assignment.id %}"
                                        class="btn btn-sm btn-primary"><i class="bi bi-eye"></i> View</a>
                                    {% if not assignment.submission %}
                                    <a href="{% url 'submit_assignment' assignment.id %}"
                                        class="btn btn-sm btn-success"><i class="bi bi-upload"></i> Submit</a>
                                    {% else %}
                                    <a href="{% url 'resubmit_assignment' assignment.id %}"
                                        class="btn btn-sm btn-warning"><i class="bi bi-arrow-repeat"></i> Resubmit</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-3">No active assignments at the moment.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Past Submissions Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-archive me-2"></i>Past Submissions</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Assignment</th>
                                <th>Course</th>
                                <th>Submitted On</th>
                                <th>Grade</th>
                                <th>Feedback</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for submission in past_submissions %}
                            <tr>
                                <td>{{ submission.assignment.title }}</td>
                                <td>{{ submission.assignment.course.name }}</td>
                                <td>{{ submission.submitted_date }}</td>
                                <td>
                                    {% if submission.grade %}
                                    {{ submission.grade }}
                                    {% else %}
                                    <span class="text-muted">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if submission.has_feedback %}
                                    <span class="badge bg-info">Available</span>
                                    {% else %}
                                    <span class="text-muted">None yet</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'view_submission' submission.id %}" class="btn btn-sm btn-info"><i
                                            class="bi bi-file-earmark-text"></i> View</a>
                                    {% if submission.can_appeal %}
                                    <a href="{% url 'request_regrade' submission.id %}"
                                        class="btn btn-sm btn-outline-secondary"><i class="bi bi-pen"></i> Request
                                        Regrade</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-3">No past submissions found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Plagiarism Status Section -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-shield-check me-2"></i>Plagiarism Check Status</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Assignment</th>
                                <th>Submission Date</th>
                                <th>Status</th>
                                <th>Similarity Score</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for check in plagiarism_checks %}
                            <tr>
                                <td>{{ check.submission.assignment.title }}</td>
                                <td>{{ check.submission.submitted_date }}</td>
                                <td>
                                    {% if check.is_complete %}
                                    <span class="badge bg-success">Complete</span>
                                    {% else %}
                                    <span class="badge bg-warning">Processing</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if check.is_complete %}
                                    {{ check.similarity_score }}%
                                    {% if check.similarity_score > 30 %}
                                    <span class="badge bg-danger">High</span>
                                    {% elif check.similarity_score > 15 %}
                                    <span class="badge bg-warning">Medium</span>
                                    {% else %}
                                    <span class="badge bg-success">Low</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="text-muted">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if check.is_complete %}
                                    <a href="{% url 'view_plagiarism_report' check.id %}" class="btn btn-sm btn-info"><i
                                            class="bi bi-file-earmark-text"></i> View Report</a>
                                    {% else %}
                                    <button class="btn btn-sm btn-outline-secondary" disabled><i
                                            class="bi bi-hourglass-split"></i> Processing</button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-3">No plagiarism checks found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}